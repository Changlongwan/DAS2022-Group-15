---
title: "project2 update"
author: "Lixia"
date: "2022/3/23"
output:
  pdf_document: default
  html_document: default
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, comment = NA, message = FALSE, warning = FALSE)
```

```{r packages}
library(kableExtra)
library(gridExtra)
library(tinytex)
library(equatiomatic)
library(gapminder)
library(ggplot2)
library(dplyr)
library(moderndive)
library(skimr)
library(plotly)
library(tidyr)
library(jtools)
library(janitor)
library(infer)
library(broom)
library(sjPlot)
library(stats)
```

```{r}
#read the data

IKEA<-read.csv("dataset15.csv")
# select variables
IKEA<-IKEA %>%
  select(category,price,sellable_online,other_colors,depth,height,width)
#remove NA data
IKEA<-na.omit(IKEA)
# handling factor variables
IKEA$category<-as.factor(IKEA$category)
IKEA$sellable_online<-as.factor(IKEA$sellable_online)
IKEA$other_colors<-as.factor(IKEA$other_colors)

IKEA$price[IKEA$price<1000]<-"p<1000"
IKEA$price[IKEA$price!="p<1000"]<-"p>=1000"
IKEA$price<-as.factor(IKEA$price)
```

# Data Description

## Sellable_online

```{r}
table1<-IKEA %>% 
  tabyl(price, sellable_online) %>% 
  adorn_percentages() %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() # To show original counts
table1 %>%
  kable() %>%
  kable_styling(latex_options = 'HOLD_position', )
```
```{r}
ggplot(IKEA, aes(x=sellable_online ,  y = ..prop.., group=price, fill=price)) + 
    geom_bar(position="dodge", stat="count") +
    labs(y = "Proportion",title = "Barplot of price by sellable_online.")
```

We can see that in the low price group (p<1000) are more true sellable online (2.0% vs 98.0%), the high price group (p>=1000) is also comprised of more true sellable online (00.0% vs 100.0%). Now we shall fit a logistic regression model to determine whether the classification of price can be predicted from sellable online.

## Height

```{r}
ggplot(data = IKEA, aes(x = price, y = height, fill = price)) +
  geom_boxplot() +
  labs(x = "price", y = "height")+ 
  theme(legend.position = "none")
```

Here we can see that the high price group (p>=1000) tend to be more height than that of low price group (p<1000). Now, letâ€™s fit a logistic regression model to see whether height is a significant predictor of the odds of the price being high or low.

# Formal data analysis

## Sellable_online

The logistic regression model is given by:
```{r}
model.sellable <- glm(price ~ sellable_online , data = IKEA, family = binomial(link = "logit"))
equatiomatic::extract_eq(model.sellable,use_coefs = TRUE)
```

Hence, the log-odds of the price being high increase by 15.2. if they are in the true sellable online group. This provides us with a point estimate of how the log-odds changes with sellable_online.

Fitting the model yields the result:
```{r}
mod.sellable.coef.logodds <- model.sellable %>%
                            summary() %>%
                            coef()
mod.sellable.coef.logodds
```

From the above results, the p-value is larger than 0.05, thus we can conclude that variable sellable_online doesn't have the impact on price.

95% confidence interval:
```{r}
sellable.logodds.lower <- mod.sellable.coef.logodds["sellable_onlineTRUE", "Estimate"] - 
                        1.96 * mod.sellable.coef.logodds["sellable_onlineTRUE", "Std. Error"]
sellable.logodds.lower
```

```{r}
sellable.logodds.upper <- mod.sellable.coef.logodds["sellable_onlineTRUE", "Estimate"] + 
                        1.96 * mod.sellable.coef.logodds["sellable_onlineTRUE", "Std. Error"]
sellable.logodds.upper
```

Hence the point estimate for the log-odds is 15.2, which has a corresponding 95% confidence interval of (-1631.737, 1662.138). 

This can be displayed graphically:
```{r}
plot_model(model.sellable, show.values = TRUE, transform = NULL,
           title = "Log-Odds (P>1000)", show.p = FALSE)
```

## Height

The logistic regression model is given by:
```{r}
model.height <- glm(price ~ height, data = IKEA, family = binomial(link = "logit"))
equatiomatic::extract_eq(model.height,use_coefs = TRUE)
```

The log-odds of the group being high price (p>=1000) increase by 0.01 for every one unit increase in height. This provides us with a point estimate of how the log-odds changes with height.

Fitting the model yields the result:
```{r}
mod.height.coef.logodds <- model.height %>%
                            summary() %>%
                            coef()
mod.height.coef.logodds
```

From the above results, the p-value is smaller than 0.05, thus we can conclude that variable height  have the impact on price.

95% confidence interval:
```{r}
confint(model.height) %>%
  kable()
```

Hence the point estimate for the log-odds is 0.01, which has a corresponding 95% confidence interval of (0.0065853,0.0155878). 

This can be displayed graphically:
```{r}
plot_model(model.height, show.values = TRUE, transform = NULL,
           title = "Log-Odds (P>1000)", show.p = FALSE)
```









